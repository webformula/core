(()=>{var F=Object.defineProperty;var T=(e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var f=(e,t,r)=>(T(e,typeof t!="symbol"?t+"":t,r),r),P=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var h=(e,t,r)=>(P(e,t,"read from private field"),r?r.call(e):t.get(e)),d=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},m=(e,t,r,n)=>(P(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var k=/^\//,L=/\/$/,_=/\/:|\*/g,A="(#(.*))?",I=/([:*])(\w+)/g,U=/\*/g,N="(?:.*)",B="(?:/$|$)",D=typeof window<"u";function C(e){return e.match(_)===null?e.trim()==="/"||e.includes("#")?new RegExp(`^${e}$`):new RegExp(`^${e}${A}$`):new RegExp(`^${e.replace(I,(t,r,n)=>`(?<${n}>[^/]+)`).replace(U,N)}${B}$`,"")}function x(e=[]){return e.map(t=>`/${t.replace(L,"").replace(k,"")}`)}function E(e,t){let r=t.find(({regex:i})=>w(e,i));if(!r)return;if(!D)return{pageConfig:r.pageConfig,route:r.route};let n=e.match(r.regex),a=Object.fromEntries(new URLSearchParams(location.search.split(/\?(.*)?$/).slice(1).join("")).entries());return{pageConfig:r.pageConfig,route:r.route,urlParameters:n?.groups,searchParameters:a}}function w(e,t){return e.split("?")[0].match(t)!==null}var $=typeof window<"u",b=[],s={pageConfigs:[],routeConfigs:[]};$&&window.addEventListener("popstate",e=>{g(new URL(e.currentTarget.location),!0)});function q(e){e.forEach(t=>{let r={pageClassPath:t.pageClassPath,notFound:t.notFound,routes:t.routes.map(({route:n})=>({route:n,regex:C(n)}))};t.notFound&&(s.notFoundRoute=r),s.pageConfigs.push(r),r.routes.forEach(({route:n,regex:a})=>{s.routeConfigs.push({route:n,regex:a,pageConfig:r})}),S(r)}),g(location),y()}$&&(window.registerAppConfig=q);function V(e,t,{notFound:r}={notFound:!1}){if(t=x([...new Set([...[].concat(t||[]),...e.routes||[]])]),!t)return console.warn("No routes provided for page");let n=!1,a={pageClass:e,notFound:r,routes:t.map(i=>{let o=C(i);return w(location.pathname,o)&&(n=!0),{route:i,regex:o}})};r&&(s.notFoundRoute=a),s.pageConfigs.push(a),a.routes.forEach(({route:i,regex:o})=>{s.routeConfigs.push({route:i,regex:o,pageConfig:a})}),S(a),n&&g(location),v()}function j(){window.webformulaCoreLinkIntercepts=!0,document.addEventListener("click",e=>{if(e.target.matches("[href]")){if(e.target.getAttribute("href").includes("://")){let t=e.target.getAttribute("target");["_blank","_self","_parent","_top"].includes(t)&&window.open(e.target.getAttribute("href"),t).focus();return}e.preventDefault(),g(new URL(e.target.href)),e.target.blur()}})}var u,l,p,c=class{constructor(){d(this,u,void 0);d(this,l,void 0);d(this,p,void 0);this.constructor.html&&(this.template=()=>new Function("page",`return \`${this.constructor.html}\`;`).call(this,this))}get searchParameters(){return h(this,l)}get urlParameters(){return h(this,u)}get route(){return h(this,p)}connectedCallback(){}disconnectedCallback(){}async beforeRender(){}async afterRender(){}template(){return""}escape(t){return t.replace(/[^\w. ]/gi,function(r){return"&#"+r.charCodeAt(0)+";"})}async render(){let t=document.querySelector("page-content");if(!t)throw Error("Could not find <page-content>");await this.beforeRender(),t.innerHTML=this.template.call(this,this);let r=document.querySelector("title");r.innerText=this.pageTitle,await this.afterRender()}_setUrlData(t={urlParameters:{},searchParameters:{},route:""}){m(this,u,t?.urlParameters||{}),m(this,l,t?.searchParameters||{}),m(this,p,t?.route)}};u=new WeakMap,l=new WeakMap,p=new WeakMap,f(c,"pageTitle"),f(c,"routes",[]),f(c,"html","");async function g(e,t=!1){let r=e.href.replace(e.origin,""),n=E(r,s.routeConfigs);if(!n&&s.notFoundRoute&&(n={pageConfig:s.notFoundRoute}),!n)return console.warn(`No page found for url: ${r}`);n.pageConfig.pageClass||(n.pageConfig.pageClass=(await import(n.pageConfig.pageClassPath)).default);let a=window.page;if(a?.constructor===n.pageConfig.pageClass){if(e.hash===location.hash)return;t||window.history.pushState({},a.title,r),window.dispatchEvent(new Event("hashchange"));return}let o=n.pageConfig.pageClass?new n.pageConfig.pageClass:{};t||window.history.pushState({},o.pageTitle,r),a&&a.disconnectedCallback(),window.page=o,o._setUrlData({urlParameters:n.urlParameters,searchParameters:n.searchParameters,route:n.route}),o.render(),document.body.scrollTop=0,document.documentElement.scrollTop=0,o.connectedCallback(),window.dispatchEvent(new Event("locationchange"))}var R;function v(){clearTimeout(R),R=setTimeout(()=>{R=void 0,!window.page&&s.notFoundRoute&&g(location)},0)}function S(e){if(e.pageClass||!e.pageClassPath)return;!!!e.routes.find(({regex:r})=>w(location.pathname,r))&&!e.pageClass&&b.push(e)}async function y(){let e=b.splice(-3);e.length!==0&&(await Promise.allSettled(e.map(t=>H(t))),y())}async function H(e){e.pageClassImportPromise=import(e.pageClassPath),e.pageClass=(await e.pageClassImportPromise).default,e.pageClassImportPromise=void 0}})();
