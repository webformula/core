(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Page:()=>a,enableLinkIntercepts:()=>g,registerPage:()=>h});class a{static pageTitle;static routes=[];static templatePath="";#e;#t;#a;constructor(){}get searchParameters(){return this.#t}get urlParameters(){return this.#e}get route(){return this.#a}connectedCallback(){}disconnectedCallback(){}async beforeRender(){}async afterRender(){}template(){return""}renderTemplateString(e=""){return new Function("page",`return \`${e}\`;`).call(this,this)}escape(e){return e.replace(/[^\w. ]/gi,(function(e){return"&#"+e.charCodeAt(0)+";"}))}async render(){const e=document.querySelector("page-content");if(!e)throw Error("Could not find <page-content>");await this.beforeRender(),e.innerHTML=this.template.call(this,this),document.querySelector("title").innerText=this.pageTitle,await this.afterRender()}_setUrlData(e={urlParameters:{},searchParameters:{},route:""}){this.#e=e?.urlParameters||{},this.#t=e?.searchParameters||{},this.#a=e?.route}}const r=/^\//,n=/\/$/,o=/\/:|\*/g,l=/([:*])(\w+)/g,i=/\*/g,s="(?:.*)",c="(?:/$|$)",u="(#(.*))?",p=[];let m,d;function h(e,t,{notFound:a,templateId:h}={notFound:!1,templateId:""}){if(!(t=function(e=[]){return e.map((e=>`/${e.replace(n,"").replace(r,"")}`))}([...new Set([...[].concat(t||[]),...e.routes||[]])])))return void console.warn("No routes provided for page");let g=!1;if(t.forEach((t=>{const a=function(e){let t;return t=null===e.match(o)?"/"===e.trim()||e.includes("#")?new RegExp(`^${e}$`):new RegExp(`^${e}${u}$`):new RegExp(`^${e.replace(l,((e,t,a)=>`(?<${a}>[^/]+)`)).replace(i,s)}${c}$`,""),t}(t);p.push({pageClass:e,route:t,routeRegex:a,templateId:h}),w(location.pathname,a)&&(g=!0)})),h){const e=document.body.querySelector(`template#${h}`);e&&(p.templateFileData=e.innerHTML)}e.templatePath&&!p.templateFileData&&(p.initialLoadPage=g,p.templateFileAbort=new AbortController,p.templateFetchPromise=fetch(e.templatePath,{priority:!0===g?"high":"low",signal:p.templateFileAbort.signal}).then((e=>e.text())).then((e=>{p.templateFileData=e}))),g&&f(location),a&&(m={pageClass:e}),clearTimeout(d),d=setTimeout((()=>{d=void 0,!window.page&&m&&f(location)}),0)}function g(){window.webformulaCoreLinkIntercepts=!0,document.addEventListener("click",(e=>{if(e.target.matches("[href]"))if(e.target.getAttribute("href").includes("://")){const t=e.target.getAttribute("target");["_blank","_self","_parent","_top"].includes(t)&&window.open(e.target.getAttribute("href"),t).focus()}else e.preventDefault(),f(new URL(e.target.href)),e.target.blur()}))}async function f(e,t=!1){const a=e.href.replace(e.origin,"");let r=function(e){const t=p.find((({routeRegex:t})=>w(e,t)));if(!t)return;const a=e.match(t.routeRegex),r=Object.fromEntries(new URLSearchParams(location.search.split(/\?(.*)?$/).slice(1).join("")).entries());return{...t,urlParameters:a?.groups,searchParameters:r}}(a);if(!r){if(!m)return void console.warn(`No page found for url: ${a}`);r=m}const n=window.page;if(n?.constructor===r.pageClass){if(e.hash===location.hash)return;return t||window.history.pushState({},n.title,a),void window.dispatchEvent(new Event("hashchange"))}const o=r.pageClass?new r.pageClass:{};t||window.history.pushState({},o.pageTitle,a);const l=r.templateId&&document.querySelector(`template#${r.templateId}`);if(l)o.template=()=>o.renderTemplateString(l.innerHTML);else if(r.pageClass.templatePath){if(!r.pageClass.templateFileData&&p.initialLoadPage)await p.templateFetchPromise;else if(!p.templateFileData){p.templateFileAbort.abort();const e=await fetch(r.pageClass.templatePath);p.templateFileData=await e.text()}p.templateFetchPromise&&(p.templateFetchPromise=void 0,p.templateFileAbort=void 0),o.template=()=>p.templateFileData}n&&n.disconnectedCallback(),window.page=o,o._setUrlData({urlParameters:r.urlParameters,searchParameters:r.searchParameters,route:r.route}),o.render(),document.body.scrollTop=0,document.documentElement.scrollTop=0,o.connectedCallback(),window.dispatchEvent(new Event("locationchange"))}function w(e,t){return null!==e.split("?")[0].match(t)}window.addEventListener("popstate",(e=>{f(new URL(e.currentTarget.location),!0)}))})();