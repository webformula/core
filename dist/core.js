(()=>{var T=Object.defineProperty;var k=(e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var f=(e,t,n)=>(k(e,typeof t!="symbol"?t+"":t,n),n),P=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var h=(e,t,n)=>(P(e,t,"read from private field"),n?n.call(e):t.get(e)),d=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},m=(e,t,n,r)=>(P(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);var L=/^\//,_=/\/$/,A=/\/:|\*/g,U="(#(.*))?",N=/([:*])(\w+)/g,B=/\*/g,D="(?:.*)",q="(?:/$|$)",v=typeof window<"u";function C(e){return e.match(A)===null?e.trim()==="/"||e.includes("#")?new RegExp(`^${e}$`):new RegExp(`^${e}${U}$`):new RegExp(`^${e.replace(N,(t,n,r)=>`(?<${r}>[^/]+)`).replace(B,D)}${q}$`,"")}function x(e=[]){return e.map(t=>`/${t.replace(_,"").replace(L,"")}`)}function E(e,t){let n=t.find(({regex:i})=>w(e,i));if(!n)return;if(!v)return{pageConfig:n.pageConfig,route:n.route};let r=e.match(n.regex),a=Object.fromEntries(new URLSearchParams(location.search.split(/\?(.*)?$/).slice(1).join("")).entries());return{pageConfig:n.pageConfig,route:n.route,urlParameters:r?.groups,searchParameters:a}}function w(e,t){return e.split("?")[0].match(t)!==null}var $=typeof window<"u",b=[],s={pageConfigs:[],routeConfigs:[]},y=!1;$&&window.addEventListener("popstate",e=>{g(new URL(e.currentTarget.location),!0)});function H(e){e.forEach(t=>{let n={pageClassPath:t.pageClassPath,notFound:t.notFound,routes:t.routes.map(({route:r})=>({route:r,regex:C(r)}))};t.notFound&&(s.notFoundRoute=n),s.pageConfigs.push(n),n.routes.forEach(({route:r,regex:a})=>{s.routeConfigs.push({route:r,regex:a,pageConfig:n})}),S(n)}),g(location),y&&F()}$&&(window.registerAppConfig=H);function j(e,t,{notFound:n}={notFound:!1}){if(t=x([...new Set([...[].concat(t||[]),...e.routes||[]])]),!t)return console.warn("No routes provided for page");let r=!1,a={pageClass:e,notFound:n,routes:t.map(i=>{let o=C(i);return w(location.pathname,o)&&(r=!0),{route:i,regex:o}})};n&&(s.notFoundRoute=a),s.pageConfigs.push(a),a.routes.forEach(({route:i,regex:o})=>{s.routeConfigs.push({route:i,regex:o,pageConfig:a})}),S(a),r&&g(location),I()}function z(){y=!0,window.webformulaCoreLinkIntercepts=!0,document.addEventListener("click",e=>{if(e.target.matches("[href]")){if(e.target.getAttribute("href").includes("://")){let t=e.target.getAttribute("target");["_blank","_self","_parent","_top"].includes(t)&&window.open(e.target.getAttribute("href"),t).focus();return}e.preventDefault(),g(new URL(e.target.href)),e.target.blur()}})}var u,l,p,c=class{constructor(){d(this,u,void 0);d(this,l,void 0);d(this,p,void 0);this.constructor.html&&(this.template=()=>new Function("page",`return \`${this.constructor.html}\`;`).call(this,this))}get searchParameters(){return h(this,l)}get urlParameters(){return h(this,u)}get route(){return h(this,p)}connectedCallback(){}disconnectedCallback(){}async beforeRender(){}async afterRender(){}template(){return""}escape(t){return t.replace(/[^\w. ]/gi,function(n){return"&#"+n.charCodeAt(0)+";"})}async render(){let t=document.querySelector("page-content");if(!t)throw Error("Could not find <page-content>");await this.beforeRender(),t.innerHTML=this.template.call(this,this);let n=document.querySelector("title");n.innerText=this.pageTitle,await this.afterRender()}_setUrlData(t={urlParameters:{},searchParameters:{},route:""}){m(this,u,t?.urlParameters||{}),m(this,l,t?.searchParameters||{}),m(this,p,t?.route)}};u=new WeakMap,l=new WeakMap,p=new WeakMap,f(c,"pageTitle"),f(c,"routes",[]),f(c,"html","");async function g(e,t=!1){let n=e.href.replace(e.origin,""),r=E(n,s.routeConfigs);if(!r&&s.notFoundRoute&&(r={pageConfig:s.notFoundRoute}),!r)return console.warn(`No page found for url: ${n}`);r.pageConfig.pageClass||(r.pageConfig.pageClass=(await import(r.pageConfig.pageClassPath)).default);let a=window.page;if(a?.constructor===r.pageConfig.pageClass){if(e.hash===location.hash)return;t||window.history.pushState({},a.title,n),window.dispatchEvent(new Event("hashchange"));return}let o=r.pageConfig.pageClass?new r.pageConfig.pageClass:{};t||window.history.pushState({},o.pageTitle,n),a&&a.disconnectedCallback(),window.page=o,o._setUrlData({urlParameters:r.urlParameters,searchParameters:r.searchParameters,route:r.route}),o.render(),document.body.scrollTop=0,document.documentElement.scrollTop=0,o.connectedCallback(),window.dispatchEvent(new Event("locationchange"))}var R;function I(){clearTimeout(R),R=setTimeout(()=>{R=void 0,!window.page&&s.notFoundRoute&&g(location)},0)}function S(e){if(e.pageClass||!e.pageClassPath)return;!!!e.routes.find(({regex:n})=>w(location.pathname,n))&&!e.pageClass&&b.push(e)}async function F(){let e=b.splice(-3);e.length!==0&&(await Promise.allSettled(e.map(t=>M(t))),F())}async function M(e){try{e.pageClass=(await import(e.pageClassPath)).default}catch(t){console.error(`Cannot load page class: ${e.pageClassPath}`),console.error(t)}}})();
